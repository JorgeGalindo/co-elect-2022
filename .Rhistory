rbind(promedio_4) %>%
rbind(promedio_5) %>%
rbind(promedio_6) %>%
rbind(promedio_7) %>%
rbind(promedio_8) %>%
rbind(promedio_9) %>%
rbind(promedio_10) %>%
rbind(promedio_11) %>%
rbind(promedio_12) %>%
pivot_wider(names_from = candidato, values_from = promedio)
promedio_evol <- tabla_dw %>%
mutate(fecha=as.character(X.1)) %>%
left_join(promedio_evol_df)
promedio_3 <- clean_df %>%
#escogiendo las que son
filter(fecha<"2022-04-23") %>% #campo post-consultas
select(encuestadora,candidato,int_voto_raw,fecha)  %>%
pivot_wider(names_from="candidato", values_from="int_voto_raw") %>%
group_by(encuestadora) %>%
slice_tail() %>%
ungroup() %>%
#introduciendo valor ponderado
pivot_longer(cols = contains("_"),
names_to = "candidato", values_to = "int_voto_raw") %>%
left_join(ponderador_df) %>%
group_by(candidato) %>%
summarize(promedio=weighted.mean(int_voto_raw,ponderador)) %>%
mutate(fecha="2022-04-22")
promedio_13 <- clean_df %>%
#escogiendo las que son
filter(fecha<"2022-04-22") %>% #campo post-consultas
select(encuestadora,candidato,int_voto_raw,fecha)  %>%
pivot_wider(names_from="candidato", values_from="int_voto_raw") %>%
group_by(encuestadora) %>%
slice_tail() %>%
ungroup() %>%
#introduciendo valor ponderado
pivot_longer(cols = contains("_"),
names_to = "candidato", values_to = "int_voto_raw") %>%
left_join(ponderador_df) %>%
group_by(candidato) %>%
summarize(promedio=weighted.mean(int_voto_raw,ponderador)) %>%
mutate(fecha="2022-04-21")
promedio_14 <- clean_df %>%
#escogiendo las que son
filter(fecha<"2022-04-20") %>% #campo post-consultas
select(encuestadora,candidato,int_voto_raw,fecha)  %>%
pivot_wider(names_from="candidato", values_from="int_voto_raw") %>%
group_by(encuestadora) %>%
slice_tail() %>%
ungroup() %>%
#introduciendo valor ponderado
pivot_longer(cols = contains("_"),
names_to = "candidato", values_to = "int_voto_raw") %>%
left_join(ponderador_df) %>%
group_by(candidato) %>%
summarize(promedio=weighted.mean(int_voto_raw,ponderador)) %>%
mutate(fecha="2022-04-19")
promedio_4 <- clean_df %>%
#escogiendo las que son
filter(fecha<"2022-04-14") %>% #campo post-consultas
select(encuestadora,candidato,int_voto_raw,fecha)  %>%
pivot_wider(names_from="candidato", values_from="int_voto_raw") %>%
group_by(encuestadora) %>%
slice_tail() %>%
ungroup() %>%
#introduciendo valor ponderado
pivot_longer(cols = contains("_"),
names_to = "candidato", values_to = "int_voto_raw") %>%
left_join(ponderador_df) %>%
group_by(candidato) %>%
summarize(promedio=weighted.mean(int_voto_raw,ponderador)) %>%
mutate(fecha="2022-04-13")
promedio_5 <- clean_df %>%
#escogiendo las que son
filter(fecha<"2022-04-08") %>% #campo post-consultas
select(encuestadora,candidato,int_voto_raw,fecha)  %>%
pivot_wider(names_from="candidato", values_from="int_voto_raw") %>%
group_by(encuestadora) %>%
slice_tail() %>%
ungroup() %>%
#introduciendo valor ponderado
pivot_longer(cols = contains("_"),
names_to = "candidato", values_to = "int_voto_raw") %>%
left_join(ponderador_df) %>%
group_by(candidato) %>%
summarize(promedio=weighted.mean(int_voto_raw,ponderador)) %>%
mutate(fecha="2022-04-07")
promedio_6 <- clean_df %>%
#escogiendo las que son
filter(fecha<"2022-04-06") %>% #campo post-consultas
select(encuestadora,candidato,int_voto_raw,fecha)  %>%
pivot_wider(names_from="candidato", values_from="int_voto_raw") %>%
group_by(encuestadora) %>%
slice_tail() %>%
ungroup() %>%
#introduciendo valor ponderado
pivot_longer(cols = contains("_"),
names_to = "candidato", values_to = "int_voto_raw") %>%
left_join(ponderador_df) %>%
group_by(candidato) %>%
summarize(promedio=weighted.mean(int_voto_raw,ponderador)) %>%
mutate(fecha="2022-04-05")
promedio_7 <- clean_df %>%
#escogiendo las que son
filter(fecha<"2022-04-04") %>% #campo post-consultas
select(encuestadora,candidato,int_voto_raw,fecha)  %>%
pivot_wider(names_from="candidato", values_from="int_voto_raw") %>%
group_by(encuestadora) %>%
slice_tail() %>%
ungroup() %>%
#introduciendo valor ponderado
pivot_longer(cols = contains("_"),
names_to = "candidato", values_to = "int_voto_raw") %>%
left_join(ponderador_df) %>%
group_by(candidato) %>%
summarize(promedio=weighted.mean(int_voto_raw,ponderador)) %>%
mutate(fecha="2022-04-03")
promedio_8 <- clean_df %>%
#escogiendo las que son
filter(fecha<"2022-04-03") %>% #campo post-consultas
select(encuestadora,candidato,int_voto_raw,fecha)  %>%
pivot_wider(names_from="candidato", values_from="int_voto_raw") %>%
group_by(encuestadora) %>%
slice_tail() %>%
ungroup() %>%
#introduciendo valor ponderado
pivot_longer(cols = contains("_"),
names_to = "candidato", values_to = "int_voto_raw") %>%
left_join(ponderador_df) %>%
group_by(candidato) %>%
summarize(promedio=weighted.mean(int_voto_raw,ponderador)) %>%
mutate(fecha="2022-04-02")
promedio_9 <- clean_df %>%
#escogiendo las que son
filter(fecha<"2022-03-30") %>% #campo post-consultas
select(encuestadora,candidato,int_voto_raw,fecha)  %>%
pivot_wider(names_from="candidato", values_from="int_voto_raw") %>%
group_by(encuestadora) %>%
slice_tail() %>%
ungroup() %>%
#introduciendo valor ponderado
pivot_longer(cols = contains("_"),
names_to = "candidato", values_to = "int_voto_raw") %>%
left_join(ponderador_df) %>%
group_by(candidato) %>%
summarize(promedio=weighted.mean(int_voto_raw,ponderador)) %>%
mutate(fecha="2022-03-29")
promedio_10 <- clean_df %>%
#escogiendo las que son
filter(fecha<"2022-03-22") %>% #campo post-consultas
select(encuestadora,candidato,int_voto_raw,fecha)  %>%
pivot_wider(names_from="candidato", values_from="int_voto_raw") %>%
group_by(encuestadora) %>%
slice_tail() %>%
ungroup() %>%
#introduciendo valor ponderado
pivot_longer(cols = contains("_"),
names_to = "candidato", values_to = "int_voto_raw") %>%
left_join(ponderador_df) %>%
group_by(candidato) %>%
summarize(promedio=weighted.mean(int_voto_raw,ponderador)) %>%
mutate(fecha="2022-03-21")
promedio_11 <- clean_df %>%
#escogiendo las que son
filter(fecha<"2022-03-21") %>% #campo post-consultas
select(encuestadora,candidato,int_voto_raw,fecha)  %>%
pivot_wider(names_from="candidato", values_from="int_voto_raw") %>%
group_by(encuestadora) %>%
slice_tail() %>%
ungroup() %>%
#introduciendo valor ponderado
pivot_longer(cols = contains("_"),
names_to = "candidato", values_to = "int_voto_raw") %>%
left_join(ponderador_df) %>%
group_by(candidato) %>%
summarize(promedio=weighted.mean(int_voto_raw,ponderador)) %>%
mutate(fecha="2022-03-20")
promedio_12 <- promedio_raw_pre_df %>%
mutate(promedio=promedio_pre) %>%
mutate(fecha="2022-03-12") %>%
select(-promedio_pre)
promedio_evol_df <- promedio_raw_df %>%
mutate(fecha="2022-05-01") %>%
rbind(promedio_1) %>%
rbind(promedio_2) %>%
rbind(promedio_3) %>%
rbind(promedio_4) %>%
rbind(promedio_5) %>%
rbind(promedio_6) %>%
rbind(promedio_7) %>%
rbind(promedio_8) %>%
rbind(promedio_9) %>%
rbind(promedio_10) %>%
rbind(promedio_11) %>%
rbind(promedio_12) %>%
rbind(promedio_13) %>%
rbind(promedio_14) %>%
pivot_wider(names_from = candidato, values_from = promedio)
promedio_evol <- tabla_dw %>%
mutate(fecha=as.character(X.1)) %>%
left_join(promedio_evol_df)
write_csv(promedio_evol,"promedio_evol.csv")
promedio_1 <- clean_df %>%
#escogiendo las que son
filter(fecha<"2022-04-30" & fecha>"2022-03-12") %>% #campo post-consultas
select(encuestadora,candidato,int_voto_raw,fecha)  %>%
pivot_wider(names_from="candidato", values_from="int_voto_raw") %>%
group_by(encuestadora) %>%
slice_tail() %>%
ungroup() %>%
#introduciendo valor ponderado
pivot_longer(cols = contains("_"),
names_to = "candidato", values_to = "int_voto_raw") %>%
left_join(ponderador_df) %>%
group_by(candidato) %>%
summarize(promedio=weighted.mean(int_voto_raw,ponderador)) %>%
mutate(fecha="2022-04-29")
promedio_2 <- clean_df %>%
#escogiendo las que son
filter(fecha<"2022-04-29" & fecha>"2022-03-12") %>% #campo post-consultas
select(encuestadora,candidato,int_voto_raw,fecha)  %>%
pivot_wider(names_from="candidato", values_from="int_voto_raw") %>%
group_by(encuestadora) %>%
slice_tail() %>%
ungroup() %>%
#introduciendo valor ponderado
pivot_longer(cols = contains("_"),
names_to = "candidato", values_to = "int_voto_raw") %>%
left_join(ponderador_df) %>%
group_by(candidato) %>%
summarize(promedio=weighted.mean(int_voto_raw,ponderador)) %>%
mutate(fecha="2022-04-28")
promedio_3 <- clean_df %>%
#escogiendo las que son
filter(fecha<"2022-04-23" & fecha>"2022-03-12") %>% #campo post-consultas
select(encuestadora,candidato,int_voto_raw,fecha)  %>%
pivot_wider(names_from="candidato", values_from="int_voto_raw") %>%
group_by(encuestadora) %>%
slice_tail() %>%
ungroup() %>%
#introduciendo valor ponderado
pivot_longer(cols = contains("_"),
names_to = "candidato", values_to = "int_voto_raw") %>%
left_join(ponderador_df) %>%
group_by(candidato) %>%
summarize(promedio=weighted.mean(int_voto_raw,ponderador)) %>%
mutate(fecha="2022-04-22")
promedio_13 <- clean_df %>%
#escogiendo las que son
filter(fecha<"2022-04-22" & fecha>"2022-03-12") %>% #campo post-consultas
select(encuestadora,candidato,int_voto_raw,fecha)  %>%
pivot_wider(names_from="candidato", values_from="int_voto_raw") %>%
group_by(encuestadora) %>%
slice_tail() %>%
ungroup() %>%
#introduciendo valor ponderado
pivot_longer(cols = contains("_"),
names_to = "candidato", values_to = "int_voto_raw") %>%
left_join(ponderador_df) %>%
group_by(candidato) %>%
summarize(promedio=weighted.mean(int_voto_raw,ponderador)) %>%
mutate(fecha="2022-04-21")
promedio_14 <- clean_df %>%
#escogiendo las que son
filter(fecha<"2022-04-20" & fecha>"2022-03-12") %>% #campo post-consultas
select(encuestadora,candidato,int_voto_raw,fecha)  %>%
pivot_wider(names_from="candidato", values_from="int_voto_raw") %>%
group_by(encuestadora) %>%
slice_tail() %>%
ungroup() %>%
#introduciendo valor ponderado
pivot_longer(cols = contains("_"),
names_to = "candidato", values_to = "int_voto_raw") %>%
left_join(ponderador_df) %>%
group_by(candidato) %>%
summarize(promedio=weighted.mean(int_voto_raw,ponderador)) %>%
mutate(fecha="2022-04-19")
promedio_4 <- clean_df %>%
#escogiendo las que son
filter(fecha<"2022-04-14" & fecha>"2022-03-12") %>% #campo post-consultas
select(encuestadora,candidato,int_voto_raw,fecha)  %>%
pivot_wider(names_from="candidato", values_from="int_voto_raw") %>%
group_by(encuestadora) %>%
slice_tail() %>%
ungroup() %>%
#introduciendo valor ponderado
pivot_longer(cols = contains("_"),
names_to = "candidato", values_to = "int_voto_raw") %>%
left_join(ponderador_df) %>%
group_by(candidato) %>%
summarize(promedio=weighted.mean(int_voto_raw,ponderador)) %>%
mutate(fecha="2022-04-13")
promedio_5 <- clean_df %>%
#escogiendo las que son
filter(fecha<"2022-04-08" & fecha>"2022-03-12") %>% #campo post-consultas
select(encuestadora,candidato,int_voto_raw,fecha)  %>%
pivot_wider(names_from="candidato", values_from="int_voto_raw") %>%
group_by(encuestadora) %>%
slice_tail() %>%
ungroup() %>%
#introduciendo valor ponderado
pivot_longer(cols = contains("_"),
names_to = "candidato", values_to = "int_voto_raw") %>%
left_join(ponderador_df) %>%
group_by(candidato) %>%
summarize(promedio=weighted.mean(int_voto_raw,ponderador)) %>%
mutate(fecha="2022-04-07")
promedio_6 <- clean_df %>%
#escogiendo las que son
filter(fecha<"2022-04-06" & fecha>"2022-03-12") %>% #campo post-consultas
select(encuestadora,candidato,int_voto_raw,fecha)  %>%
pivot_wider(names_from="candidato", values_from="int_voto_raw") %>%
group_by(encuestadora) %>%
slice_tail() %>%
ungroup() %>%
#introduciendo valor ponderado
pivot_longer(cols = contains("_"),
names_to = "candidato", values_to = "int_voto_raw") %>%
left_join(ponderador_df) %>%
group_by(candidato) %>%
summarize(promedio=weighted.mean(int_voto_raw,ponderador)) %>%
mutate(fecha="2022-04-05")
promedio_7 <- clean_df %>%
#escogiendo las que son
filter(fecha<"2022-04-04" & fecha>"2022-03-12") %>% #campo post-consultas
select(encuestadora,candidato,int_voto_raw,fecha)  %>%
pivot_wider(names_from="candidato", values_from="int_voto_raw") %>%
group_by(encuestadora) %>%
slice_tail() %>%
ungroup() %>%
#introduciendo valor ponderado
pivot_longer(cols = contains("_"),
names_to = "candidato", values_to = "int_voto_raw") %>%
left_join(ponderador_df) %>%
group_by(candidato) %>%
summarize(promedio=weighted.mean(int_voto_raw,ponderador)) %>%
mutate(fecha="2022-04-03")
promedio_8 <- clean_df %>%
#escogiendo las que son
filter(fecha<"2022-04-03" & fecha>"2022-03-12") %>% #campo post-consultas
select(encuestadora,candidato,int_voto_raw,fecha)  %>%
pivot_wider(names_from="candidato", values_from="int_voto_raw") %>%
group_by(encuestadora) %>%
slice_tail() %>%
ungroup() %>%
#introduciendo valor ponderado
pivot_longer(cols = contains("_"),
names_to = "candidato", values_to = "int_voto_raw") %>%
left_join(ponderador_df) %>%
group_by(candidato) %>%
summarize(promedio=weighted.mean(int_voto_raw,ponderador)) %>%
mutate(fecha="2022-04-02")
promedio_9 <- clean_df %>%
#escogiendo las que son
filter(fecha<"2022-03-30" & fecha>"2022-03-12") %>% #campo post-consultas
select(encuestadora,candidato,int_voto_raw,fecha)  %>%
pivot_wider(names_from="candidato", values_from="int_voto_raw") %>%
group_by(encuestadora) %>%
slice_tail() %>%
ungroup() %>%
#introduciendo valor ponderado
pivot_longer(cols = contains("_"),
names_to = "candidato", values_to = "int_voto_raw") %>%
left_join(ponderador_df) %>%
group_by(candidato) %>%
summarize(promedio=weighted.mean(int_voto_raw,ponderador)) %>%
mutate(fecha="2022-03-29")
promedio_10 <- clean_df %>%
#escogiendo las que son
filter(fecha<"2022-03-22" & fecha>"2022-03-12") %>% #campo post-consultas
select(encuestadora,candidato,int_voto_raw,fecha)  %>%
pivot_wider(names_from="candidato", values_from="int_voto_raw") %>%
group_by(encuestadora) %>%
slice_tail() %>%
ungroup() %>%
#introduciendo valor ponderado
pivot_longer(cols = contains("_"),
names_to = "candidato", values_to = "int_voto_raw") %>%
left_join(ponderador_df) %>%
group_by(candidato) %>%
summarize(promedio=weighted.mean(int_voto_raw,ponderador)) %>%
mutate(fecha="2022-03-21")
promedio_11 <- clean_df %>%
#escogiendo las que son
filter(fecha<"2022-03-21" & fecha>"2022-03-12") %>% #campo post-consultas
select(encuestadora,candidato,int_voto_raw,fecha)  %>%
pivot_wider(names_from="candidato", values_from="int_voto_raw") %>%
group_by(encuestadora) %>%
slice_tail() %>%
ungroup() %>%
#introduciendo valor ponderado
pivot_longer(cols = contains("_"),
names_to = "candidato", values_to = "int_voto_raw") %>%
left_join(ponderador_df) %>%
group_by(candidato) %>%
summarize(promedio=weighted.mean(int_voto_raw,ponderador)) %>%
mutate(fecha="2022-03-20")
promedio_12 <- promedio_raw_pre_df %>%
mutate(promedio=promedio_pre) %>%
mutate(fecha="2022-03-12") %>%
select(-promedio_pre)
promedio_evol_df <- promedio_raw_df %>%
mutate(fecha="2022-05-01") %>%
rbind(promedio_1) %>%
rbind(promedio_2) %>%
rbind(promedio_3) %>%
rbind(promedio_4) %>%
rbind(promedio_5) %>%
rbind(promedio_6) %>%
rbind(promedio_7) %>%
rbind(promedio_8) %>%
rbind(promedio_9) %>%
rbind(promedio_10) %>%
rbind(promedio_11) %>%
rbind(promedio_12) %>%
rbind(promedio_13) %>%
rbind(promedio_14) %>%
pivot_wider(names_from = candidato, values_from = promedio)
promedio_evol <- tabla_dw %>%
mutate(fecha=as.character(X.1)) %>%
left_join(promedio_evol_df)
write_csv(promedio_evol,"promedio_evol.csv")
library(tidyverse)
#Primero, cogemos la recopilación de encuestas de recetas-electorales.com
raw_df <- read_csv("https://raw.githubusercontent.com/nelsonamayad/Elecciones-presidenciales-2022/main/Encuestas%202022/encuestas_2022.csv")
#También cargamos la evaluación de lasillavacia.com para la ponderación
ponderador_df <- read_csv("ponderador_lsv.csv") %>%
mutate(ponderador=nota_lsv*0.02+0.8) #hace que cada valor tenga un peso equivalente a 1 si es perfecto o se le reste hasta un 20% de peso
###LIMPIEZA & NORMALIZACIÓN
norm_df <- raw_df %>%
#selección de variables relevantes
select(encuestadora,muestra,fecha,ns_nr,otros,blanco,sergio_fajardo,ingrid_betancourt,federico_gutierrez,rodolfo_hernandez,gustavo_petro) %>%
#añadiendo indefinición como categoría
replace_na(list(ns_nr = 0, otros = 0, blanco=0 )) %>%
mutate(indef=ns_nr+otros+blanco, #suma de todo votante probable sin candidato
asumindef=5.58, #asunción de nulo+blancos = la media del % de la suma de ambos en 2014 y 2018; 1a vuelta
votodefin=100-indef+asumindef, #todos los votantes definidos
) %>%
select(-otros,-blanco,-ns_nr) %>%
#pivoteando
pivot_longer(cols = contains("_"),
names_to = "candidato", values_to = "int_voto_raw") %>%
replace_na(list( int_voto_raw=0)) %>%
#normalizando y distribuyendo
mutate(int_voto_norm = int_voto_raw/votodefin*100, #voto normalizado
int_voto_dist = (int_voto_raw+(indef*(int_voto_raw/100))), #voto distribuyendo indecisos
fecha=as.Date(fecha, format="%Y-%m-%d"))
##PROMEDIOS NORMALIZADOS
###PROMEDIO NORMALIZADO CON ÚLTIMAS ENCUESTAS DE CADA CASA
promedio_norm_df <- norm_df %>%
#escogiendo las que son
filter(fecha>"2022-03-12") %>% #campo post-consultas
select(encuestadora,candidato,int_voto_norm,fecha) %>%
pivot_wider(names_from="candidato", values_from="int_voto_norm") %>%
group_by(encuestadora) %>%
slice_tail() %>%
ungroup() %>%
#introduciendo valor ponderado
pivot_longer(cols = contains("_"),
names_to = "candidato", values_to = "int_voto_norm") %>%
left_join(ponderador_df) %>%
group_by(candidato) %>%
summarize(promedio=weighted.mean(int_voto_norm,ponderador))
###PROMEDIO NORMALIZADO PRE.CONSULTAS
promedio_norm_pre_df <- norm_df %>%
#escogiendo las que son
filter(fecha<"2022-03-12") %>% #campo post-consultas
select(encuestadora,candidato,int_voto_norm,fecha) %>%
pivot_wider(names_from="candidato", values_from="int_voto_norm") %>%
group_by(encuestadora) %>%
slice_tail() %>%
ungroup() %>%
#introduciendo valor ponderado
pivot_longer(cols = contains("_"),
names_to = "candidato", values_to = "int_voto_norm") %>%
left_join(ponderador_df) %>%
group_by(candidato) %>%
summarize(promedio=weighted.mean(int_voto_norm,ponderador))
##PROMEDIOS CON INDEFINIDOS DISTRIBUIDOS PROPORCIONALMENTE A LA VOTACIÓN
###PROMEDIO NORMALIZADO CON ÚLTIMAS ENCUESTAS DE CADA CASA
promedio_distr_df <- norm_df %>%
#escogiendo las que son
filter(fecha>"2022-03-12") %>% #campo post-consultas
select(encuestadora,candidato,int_voto_dist,fecha) %>%
pivot_wider(names_from="candidato", values_from="int_voto_dist") %>%
group_by(encuestadora) %>%
slice_tail() %>%
ungroup() %>%
#introduciendo valor ponderado
pivot_longer(cols = contains("_"),
names_to = "candidato", values_to = "int_voto_dist") %>%
left_join(ponderador_df) %>%
group_by(candidato) %>%
summarize(promedio=weighted.mean(int_voto_dist,ponderador))
###PROMEDIO NORMALIZADO PRE.CONSULTAS
promedio_distr_pre_df <- norm_df %>%
#escogiendo las que son
filter(fecha<"2022-03-12") %>% #campo post-consultas
select(encuestadora,candidato,int_voto_dist,fecha) %>%
pivot_wider(names_from="candidato", values_from="int_voto_dist") %>%
group_by(encuestadora) %>%
slice_tail() %>%
ungroup() %>%
#introduciendo valor ponderado
pivot_longer(cols = contains("_"),
names_to = "candidato", values_to = "int_voto_dist") %>%
left_join(ponderador_df) %>%
group_by(candidato) %>%
summarize(promedio=weighted.mean(int_voto_dist,ponderador))
View(promedio_distr_df)
View(promedio_evol)
